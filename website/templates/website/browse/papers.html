{% extends "website/base.html" %}

{% block title %}Papers{% endblock %}

{% block content %}

<div class="container mt-4">

<!-- HEADER -->

<div class="chapter-header">

<div>

<div class="chapter-title">

üìÑ Chapter Papers

</div>

<div class="chapter-sub">

Access previous year question papers

</div>

</div>


<button onclick="history.back()"
class="btn btn-outline-light">

‚Üê Back

</button>

</div>



<!-- STATS BAR -->

<div class="stats-bar">

<div class="stat-box">

<div id="totalPapers"
class="stat-number">

0

</div>

<div class="stat-label">

Total Papers

</div>

</div>


<div class="stat-box">

<div class="stat-number">

PDF

</div>

<div class="stat-label">

Format

</div>

</div>


<div class="stat-box">

<div id="adminStat"
class="stat-number">

User

</div>

<div class="stat-label">

Role

</div>

</div>

</div>



<!-- ADMIN BUTTON -->

<button id="addBtn"

class="chapter-btn mb-4 d-none"

onclick="openUploadModal()">

+ Upload Paper

</button>



<!-- LOADER -->

<div id="loader"

class="text-center mt-5">

<div class="spinner-border text-primary"></div>

</div>



<!-- EMPTY -->

<div id="empty"

class="text-center mt-5 d-none">

No papers available

</div>



<!-- GRID -->

<div id="papersList"

class="row g-4">

</div>



</div>



<!-- MODAL -->

<div class="modal fade"

id="uploadModal">

<div class="modal-dialog">

<div class="modal-content bg-dark text-light">

<div class="modal-header">

<h5>

Upload Paper

</h5>

<button class="btn-close btn-close-white"

data-bs-dismiss="modal"></button>

</div>


<div class="modal-body">

<input

id="titleInput"

class="form-control mb-3"

placeholder="Paper title">


<input

type="file"

id="fileInput"

class="form-control"

accept="application/pdf">

</div>


<div class="modal-footer">

<button

class="chapter-btn"

onclick="uploadPaper()">

Upload

</button>

</div>

</div>

</div>

</div>



<style>


.chapter-header{

display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:30px;

}


.chapter-title{

font-size:30px;
font-weight:700;
color:#fff;

}


.chapter-sub{

color:#9ca3af;
font-size:14px;

}


/* STATS BAR */

.stats-bar{

display:flex;
gap:20px;
margin-bottom:30px;

}


.stat-box{

flex:1;
background:linear-gradient(135deg,#111827,#1f2937);
padding:20px;
border-radius:14px;
text-align:center;
border:1px solid rgba(255,255,255,0.05);

animation:fadeUp 0.6s ease;

}


.stat-number{

font-size:22px;
font-weight:700;
color:#60a5fa;

}


.stat-label{

font-size:13px;
color:#9ca3af;

}


/* CARD */

.chapter-card{

background:linear-gradient(135deg,#111827,#1f2937);
border-radius:16px;
padding:25px;
cursor:pointer;
transition:all 0.3s ease;
border:1px solid rgba(255,255,255,0.05);
position:relative;
overflow:hidden;

animation:fadeUp 0.7s ease;

cursor:default;   /* IMPORTANT FIX */

}


.chapter-card:hover{

transform:translateY(-6px);
box-shadow:0 15px 35px rgba(37,99,235,0.3);

}


.chapter-card::before{

content:"";
position:absolute;
top:0;
left:-100%;
width:100%;
height:100%;
background:linear-gradient(120deg,transparent,rgba(255,255,255,0.1),transparent);
transition:0.6s;

}


.chapter-card:hover::before{

left:100%;

}


.chapter-btn{

background:linear-gradient(90deg,#2563eb,#4f46e5);
border:none;
border-radius:8px;
padding:10px 15px;
color:#fff;
font-weight:600;

}


/* ANIMATION */

@keyframes fadeUp{

from{

opacity:0;
transform:translateY(20px);

}

to{

opacity:1;
transform:translateY(0);

}

}


</style>



<script>


const token = localStorage.getItem("access_token")

const isAdmin = localStorage.getItem("is_admin")

const chapterId = new URLSearchParams(

window.location.search

).get("chapter")


//const API = `/api/papers/?chapter=${chapterId}`

const API = `https://education-backend-2-qmvp.onrender.com/api/papers/?chapter=${chapterId}`




if(isAdmin==="true"){

addBtn.classList.remove("d-none")

adminStat.innerText="Admin"

}



function loadPapers(){

fetch(API,{

headers:{

Authorization:`Bearer ${token}`

}

})

.then(res=>res.json())

.then(data=>{


loader.style.display="none"


totalPapers.innerText=data.results.length


if(data.results.length===0){

empty.classList.remove("d-none")

return

}


let html=""


data.results.forEach(p=>{


    html+=`

    <div class="col-md-4">
    
    <div class="chapter-card">
    
    <div class="chapter-icon">
    
    üìÑ
    
    </div>
    
    
    <div class="fw-bold mb-3">
    
    ${p.title}
    
    </div>
    
    
    <!-- BUTTON CONTAINER -->
    
    <div class="paper-actions" style="display:flex; gap:10px;">
    
    
    <a href="/papers/${p.id}/preview/"
    class="chapter-btn">
    
    Preview
    
    </a>
    
    
    <a href="${p.pdf}"
    download
    class="chapter-btn download-btn">
    
    Download
    
    </a>
    
    
    ${isAdmin==="true" ? `
    
    <button
    class="chapter-btn delete-btn"
    onclick="event.stopPropagation(); deletePaper(${p.id})">
    
    Delete
    
    </button>
    
    `:""}
    
    
    </div>
    
    
    </div>
    
    </div>
    
    `
    

})


papersList.innerHTML=html


})


}


function openUploadModal(){

new bootstrap.Modal(uploadModal).show()

}


function uploadPaper(){

const form=new FormData()

form.append("title",titleInput.value)

form.append("pdf",fileInput.files[0])

form.append("chapter",chapterId)
https://education-backend-2-qmvp.onrender.com

//fetch("/api/papers/",{
fetch("https://education-backend-2-qmvp.onrender.com/api/papers/",{

method:"POST",

headers:{

Authorization:`Bearer ${token}`

},

body:form

})

.then(()=>{
    location.reload()
    titleInput.value = "";
    fileInput.value = ""; 
})

}


function deletePaper(id){
    
//fetch(`/api/papers/${id}/`,{
fetch(`https://education-backend-2-qmvp.onrender.com/api/papers/${id}/`,{

method:"DELETE",

headers:{

Authorization:`Bearer ${token}`

}

})

.then(()=>location.reload())

}


loadPapers()


</script>


{% endblock %}
